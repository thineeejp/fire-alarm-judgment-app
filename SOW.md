
## **作業指示書 (SOW)**

**プロジェクト名:** 令第21条第1項第7号の判定ロジック厳密化とUI修正

**発行日:** 2025/08/18

**バージョン:** 5.0 (7号判定 最終版)

---

### 1. プロジェクト概要

本プロジェクトは、「自動火災報知設備 判定アプリ」において、令第21条第1項第7号（以下、7号）の判定方法が不正確である問題を修正するものである。
現状は「特定一階段等防火対象物」という包括的なチェックボックスで判定しているが、法令上の7号の条件はより限定的である。さらに、建物が「小規模特定用途複合防火対象物」（以下、小規模特複）である場合に、設置義務の範囲に特例が適用される点が考慮されていない。
本作業では、UIの質問内容を法令の要件に準拠させ、小規模特複であるか否かに応じて、判定結果の表示が正しく制御されるようにコアロジックを修正する。

### 2. 目的とゴール

*   **目的:** 7号の判定ロジックとUIを法令に準拠させ、小規模特複の特例を正確に反映させる。
*   **ゴール:**
    1.  UIのチェックボックスの文言を、法令上の7号の条件を直接問う形に修正する。
    2.  `ui.js`を修正し、新しいチェックボックスの値を新しいプロパティとして収集するように変更する。
    3.  `hantei.js`を修正し、7号に該当する場合は常に「全体義務」として判定する。
    4.  7号該当かつ小規模特複である場合に限り、結果表示時に設置範囲の特例に関する補足メッセージが表示されるよう、既存のフラグ(`is設置範囲限定フラグ`)を正しく設定する。

### 3. 作業範囲 (Scope of Work)

#### **3.1. `index.html` の修正 (UIの質問文言)**

*   **対象:** `name="specific-single-stair"` を持つラジオボタンが含まれる `form-group` の `div` 要素。
*   **タスク:** 対象の `div` 要素全体を、以下のHTMLブロックに**完全に置き換える**。
    ```html
    <div class="form-group">
        <label class="form-label">
            令第21条第1項第7号の条件
            <span class="help-icon" data-help="特定用途部分が避難階以外の階にあり、そこから地上への直通階段が実質的に1つしかない場合にチェックします。">
                <span class="material-icons">help_outline</span>
            </span>
        </label>
        <div class="radio-group">
            <label class="radio-label">
                <input type="radio" name="item7-condition" value="true" class="radio-input">
                <span class="radio-custom"></span>
                該当する
            </label>
            <label class="radio-label">
                <input type="radio" name="item7-condition" value="false" class="radio-input" checked>
                <span class="radio-custom"></span>
                該当しない
            </label>
        </div>
    </div>
    ```

#### **3.2. `ui.js` の修正 (データ収集)**

*   **対象:** `collectData` 関数。
*   **タスク:** `建物情報` オブジェクトのプロパティ定義を修正する。
    1.  `特定一階段フラグ` の行を**削除**する。
    2.  代わりに `nanaGouJoukenFlag` という新しいプロパティを**追加**し、`name="item7-condition"` のラジオボタンから値を取得するようにする。
    ```javascript
    // 修正前
    特定一階段フラグ: document.querySelector('input[name="specific-single-stair"]:checked')?.value === 'true',

    // 修正後
    nanaGouJoukenFlag: document.querySelector('input[name="item7-condition"]:checked')?.value === 'true',
    ```

#### **3.3. `hantei.js` の修正 (コアロジック)**

*   **対象:** `判定実行_令21` 関数。
*   **タスク:** 関数内の7号判定ロジックを、以下のコードブロックに**完全に置き換える**。
    ```javascript
    // 7号 (常に全体義務として判定)
    if (!is全体義務確定 && 建物情報.nanaGouJoukenFlag === true) {
        判定結果.全体義務 = "7号";
        is全体義務確定 = true;

        // ただし、小規模特定用途複合防火対象物の場合、
        // 3号と同様に設置範囲が限定されるため、フラグを立てておく。
        // これにより、結果表示時に補足メッセージが自動的に追加される。
        if (建物情報.is小規模特複フラグ === true) {
            判定結果.is設置範囲限定フラグ = true;
        }
    }
    ```

### 4. 成果物 (Deliverables)

1.  上記タスクが全て適用された以下の3つのファイル:
    *   `index.html`
    *   `ui.js`
    *   `hantei.js`
2.  実行した変更内容のサマリーレポート。

### 5. 受入基準 (Acceptance Criteria)

以下の全てのテストケースを満たした場合に、本作業は完了とみなされる。

1.  **UIの確認:** アプリケーションをブラウザで表示した際、7号に関する質問の文言が「令第21条第1項第7号の条件」に変わっていること。

2.  **テストケース1: 7号該当 & 非・小規模特複**
    *   **入力:**
        *   「7号の条件」: **該当する** を選択。
        *   主用途: `(16)項イ`
        *   「小規模特複」: **いいえ** を選択。（または(16)項イ以外の用途）
    *   **期待される結果:**
        *   判定結果に「**該当する号: 7**」と表示される。
        *   判定結果に「**建物全体に設置義務があります（7号）**」と表示される。
        *   設置範囲限定の**「【補足事項】...」メッセージは表示されない**こと。

3.  **テストケース2: 7号該当 & 小規模特複**
    *   **入力:**
        *   「7号の条件」: **該当する** を選択。
        *   主用途: `(16)項イ`
        *   「小規模特複」: **はい** を選択。
    *   **期待される結果:**
        *   判定結果に「**該当する号: 7**」と表示される。
        *   判定結果に「**建物全体に設置義務があります（7号）**」と表示される。
        *   上記に**加えて**、設置範囲限定の**「【補足事項】...」メッセージが正しく表示される**こと。