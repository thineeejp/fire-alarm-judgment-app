# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

このプロジェクトは「自動火災報知設備 判定アプリ」で、消防法施行令第21条に基づく自動火災報知設備の設置義務と特定小規模施設用自動火災報知設備（特小自火報）の適用可否を判定するWebアプリケーションです。純粋なHTML/CSS/JavaScriptで構築されており、PWA（Progressive Web App）として動作します。

## アーキテクチャとファイル構成

### 主要ファイル
- `index.html` - メインのHTMLファイル、PWA対応のマークアップ
- `hantei.js` - 判定ロジックの中核モジュール（消防法の判定アルゴリズム）
- `ui.js` - UI制御とユーザーインタラクション
- `main.js` - アプリケーション初期化とグローバル機能
- `styles.css` - レスポンシブデザインのスタイル
- `manifest.json` - PWAマニフェスト

### アーキテクチャの特徴
1. **モジュール分離**: 判定ロジック（`hantei.js`）とUI制御（`ui.js`）が完全に分離
2. **段階的判定**: 令第21条の判定 → 特小自火報の判定という2段階プロセス
3. **動的フォーム**: 主用途の選択により複合用途や階情報の入力フォームが動的に生成

### 判定フロー
1. `判定実行_令21(建物情報)` - 令第21条1～15号の設置義務を判定
2. `特小判定実行(判定結果_令21, 建物情報)` - イ号、ロ号、ハ号の特小自火報適用可否を判定
3. `generateResultDescription()` - 判定結果を日本語で説明

## 開発時の注意事項

### 判定ロジックの修正
- `hantei.js`の判定ロジックは複雑な消防法の条文に基づいているため、修正時は必ず法令条文と照合すること
- 特に「小規模特定用途複合防火対象物」（`is小規模特複フラグ`）の判定は設置範囲限定の特例に影響する
- ロ号の面積計算は「規則ヘ」の条文に基づく厳密な計算が実装されている

### UI開発
- フォームは主用途によって動的に変化するため、`updateForm()`関数の動作を理解すること
- 複合用途や階情報の追加/削除機能は`complexUseCounter`と`floorInfoCounter`で管理
- レスポンシブデザインでモバイル対応済み

### テスト環境
このプロジェクトには特別なビルドプロセスはありません。ローカルサーバーで直接実行できます：

```bash
# Python 3の場合
python -m http.server 8000

# Node.jsの場合
npx http-server

# VSCode Live Server拡張機能も利用可能
```

### デバッグ
- `main.js`の`appConfig.debug: true`でデバッグモードが有効
- ブラウザの開発者ツールで詳細なログが確認可能
- 判定結果は`console.log`で詳細に出力される

### PWA機能
- Service Worker (`sw.js`) によるオフライン対応
- マニフェストファイルによるインストール可能なアプリ
- アイコンは`icons/`ディレクトリに格納

## 法令対応の重要事項

このアプリは日本の消防法に基づく判定システムのため、以下の点に特に注意：

1. **法令条文の正確性**: 判定ロジックは消防法施行令第21条および関連省令に準拠
2. **用途分類の厳密性**: 防火対象物の用途分類（(1)項イ、(16)項イ等）は法令上の定義に完全準拠
3. **面積計算の精度**: 特に複合用途建物の面積計算は規則に基づく厳密な計算が必要
4. **更新の追跡**: 法令改正時は対応するロジックの更新が必要

### 特に重要な概念
- **小規模特定用途複合防火対象物**: 延べ面積300㎡以上500㎡未満の(16)項イ建物の特例
- **みなし従属**: 複合用途建物における従属的用途の扱い
- **設置範囲限定**: 小規模特複建物における設置範囲の制限

## 日本語対応
- UIとコメントは日本語
- 変数名や関数名も日本語を使用（`建物情報`、`判定結果_令21`等）
- これは消防法の専門用語と対応させるための設計判断