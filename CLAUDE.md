# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

このプロジェクトは「自動火災報知設備 判定アプリ」で、消防法施行令第21条に基づく自動火災報知設備の設置義務と特定小規模施設用自動火災報知設備（特小自火報）の適用可否を判定するWebアプリケーションです。純粋なHTML/CSS/JavaScriptで構築されており、PWA（Progressive Web App）として動作します。

## 開発コマンド

### ローカル開発サーバーの起動
このプロジェクトには特別なビルドプロセスはありません。ローカルサーバーで直接実行できます：

```bash
# Python 3の場合
python -m http.server 8000

# Node.jsの場合
npx http-server

# VSCode Live Server拡張機能も利用可能
```

### デバッグ
- `main.js`の`appConfig.debug: true`でデバッグモードが有効
- ブラウザの開発者ツールで詳細なログが確認可能
- 判定結果は`console.log`で詳細に出力される

## アーキテクチャとファイル構成

### 主要ファイル
- `index.html` - メインのHTMLファイル、PWA対応のマークアップ
- `hantei.js` - 判定ロジックの中核モジュール（消防法の判定アルゴリズム）
- `ui.js` - UI制御とユーザーインタラクション
- `main.js` - アプリケーション初期化とグローバル機能
- `styles.css` - レスポンシブデザインのスタイル
- `manifest.json` - PWAマニフェスト
- `sw.js` - Service Worker（オフライン対応）

### アーキテクチャの特徴
1. **モジュール分離**: 判定ロジック（`hantei.js`）とUI制御（`ui.js`）が完全に分離
2. **段階的判定**: 令第21条の判定 → 特小自火報の判定という2段階プロセス
3. **動的フォーム**: 主用途の選択により複合用途の入力フォームが動的に生成
4. **特殊要件判定**: 特殊要件該当時は判定をスキップし、個別検討を促すメッセージを表示

### 判定フロー
1. **入力検証**: 必須項目（7号条件、特殊要件）の選択チェック
2. **特殊要件判定**: `specialConditionsFlag === true`の場合は判定をスキップ
3. **通常判定**: `判定実行_令21(建物情報)` - 令第21条1～15号の設置義務を判定
4. **特小判定**: `特小判定実行(判定結果_令21, 建物情報)` - イ号、ロ号、ハ号の特小自火報適用可否を判定
5. **結果表示**: `generateResultDescription()` - 判定結果を日本語で説明

### データ構造
```javascript
建物情報 = {
    主用途: string,
    延べ面積: number,
    nanaGouJoukenFlag: boolean | null,  // 7号条件（必須選択）
    specialConditionsFlag: boolean | null,  // 特殊要件（必須選択）
    複合用途リスト: [
        {
            用途: string,
            面積: number,
            入居宿泊フラグ: boolean | null
        }
    ]
}
```

## 開発時の注意事項

### 判定ロジックの修正
- `hantei.js`の判定ロジックは複雑な消防法の条文に基づいているため、修正時は必ず法令条文と照合すること
- 特に「小規模特定用途複合防火対象物」（`is小規模特複フラグ`）の判定は設置範囲限定の特例に影響する
- ロ号の面積計算は「規則ヘ」の条文に基づく厳密な計算が実装されている

### UI開発の重要なパターン
- **動的フォーム**: `updateForm()`関数が主用途によってフォームを動的変更
- **スマートデフォルト**: (16)項イ選択時に(5)項イが自動で第1構成用途として追加
- **イベント委譲**: 動的に生成される要素には`document.addEventListener('click', ...)`を使用
- **必須選択**: 7号条件と特殊要件はバリデーションで必須選択を強制

### 複合用途の管理
- `complexUseCounter`でID管理
- 構成用途１は固定テンプレート（削除不可、(5)項イ固定）
- 構成用途２以降は通常テンプレート（削除可、用途選択可）
- データ収集では固定項目と通常項目の両方に対応

### 特殊要件の処理
- 「該当する」選択時は`showSpecialConditionsMessage()`で専用メッセージ表示
- 通常判定は実行せず、個別検討を促す
- 「該当しない」または未選択時のみ通常のバリデーション実行

## 法令対応の重要事項

このアプリは日本の消防法に基づく判定システムのため、以下の点に特に注意：

1. **法令条文の正確性**: 判定ロジックは消防法施行令第21条および関連省令に準拠
2. **用途分類の厳密性**: 防火対象物の用途分類（(1)項イ、(16)項イ等）は法令上の定義に完全準拠
3. **面積計算の精度**: 特に複合用途建物の面積計算は規則に基づく厳密な計算が必要
4. **更新の追跡**: 法令改正時は対応するロジックの更新が必要

### 特に重要な概念
- **小規模特定用途複合防火対象物**: 延べ面積300㎡以上500㎡未満の(16)項イ建物の特例
- **みなし従属**: 複合用途建物における従属的用途の扱い
- **設置範囲限定**: 小規模特複建物における設置範囲の制限
- **7号条件**: 特定用途部分が避難階以外にあり、直通階段が1つしかない場合

## 日本語対応
- UIとコメントは日本語
- 変数名や関数名も日本語を使用（`建物情報`、`判定結果_令21`等）
- これは消防法の専門用語と対応させるための設計判断

## PWA機能
- Service Worker (`sw.js`) によるオフライン対応
- マニフェストファイルによるインストール可能なアプリ
- アイコンは`icons/`ディレクトリに格納
- モバイル対応とレスポンシブデザイン実装済み